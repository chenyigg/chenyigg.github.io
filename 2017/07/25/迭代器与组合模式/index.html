<!DOCTYPE html><html lang="zh-Hans"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> 设计模式 之 迭代器与组合模式 · Hexo</title><meta name="description" content="设计模式 之 迭代器与组合模式 - John Doe"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/favicon.png"><link rel="stylesheet" href="/css/apollo.css"><link rel="search" type="application/opensearchdescription+xml" href="http://yoursite.com/atom.xml" title="Hexo"></head><body><div class="wrap"><header><a href="/" class="logo-link"><img src="/favicon.png" alt="logo"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">BLOG</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">ARCHIVE</a></li><li class="nav-list-item"><a href="https://weibo.com/u/1038839880" target="_blank" class="nav-list-link">WEIBO</a></li><li class="nav-list-item"><a href="https://github.com/chenyigg" target="_blank" class="nav-list-link">GITHUB</a></li></ul></header><main class="container"><div class="post"><article class="post-block"><h1 class="post-title">设计模式 之 迭代器与组合模式</h1><div class="post-info">Jul 25, 2017</div><div class="post-content"><h1 id="迭代器与组合模式"><a href="#迭代器与组合模式" class="headerlink" title="迭代器与组合模式"></a>迭代器与组合模式</h1><blockquote>
<p><strong>迭代器模式</strong> 提供一种方法 <em>顺序访问</em> 一个聚合对象中的各个元素，而又 <em>不暴露</em> 其内部的表示。<a id="more"></a></p>
<p>是迭代器模式把在元素之间游走的 <strong>责任</strong> 交给迭代器，而不是聚合对象。这不仅让聚合的接口和实现变得更加 <strong>简洁</strong> ，也可以让聚合更专注在它所应该专注的事情上面。</p>
</blockquote>
<h3 id="迭代器模式-类图"><a href="#迭代器模式-——-类图" class="headerlink" title="迭代器模式 —— 类图"></a>迭代器模式 —— 类图</h3><p><img src="file:///mnt/D/%E7%AC%94%E8%AE%B0/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E8%BF%AD%E4%BB%A3%E5%99%A8%E6%A8%A1%E5%BC%8F.png" alt=""></p>
<h3 id="迭代器与集合"><a href="#迭代器与集合" class="headerlink" title="迭代器与集合"></a>迭代器与集合</h3><p>​    Collection 和 Iterator 的好处在于，每个 Collection 都知道如何创建自己的 Iterator。只要调用 ArrayList 上的 iterator() ，就可以返回一个具体的 Iterator ，而你根本不需要 <em>知道或关心</em> 到底使用了哪个具体类，你只要使用它的 Iterator 接口就可以了。</p>
<p>​    Java 新形式的 for 语句，称为 for / in。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">for</span> (Object object: collection) &#123; ... &#125;</div></pre></td></tr></table></figure>
<h3 id="设计原则"><a href="#设计原则" class="headerlink" title="设计原则"></a>设计原则</h3><h4 id="1-一个类应该只有一个引起变化的原因"><a href="#1-一个类应该只有一个引起变化的原因。" class="headerlink" title="1. 一个类应该只有一个引起变化的原因。"></a>1. 一个类应该只有一个引起变化的原因。</h4><p>​    如果有一个类具有两个变化的原因，那么这会使得将来该类的变化几率 <em>上升</em> ，而当它真的改变时，你的设计中同时有两个方面将会受到影响。 <strong>区分</strong> 设计中的责任，是最困难的事情之一。</p>
<p>​    类的每个责任都有改变的 <strong>潜在</strong> 区域。超过一个责任，意味着超过一个改变的区域。尽量让每个类保持 <strong>单一</strong> 责任。</p>
<h1 id=""><a href="#" class="headerlink" title=" "></a> </h1><blockquote>
<p><strong>组合模式</strong> 允许你将对象组合称树型结构来表现 “整体 / 部分” 层次结构。组合能让客户以一致的方式处理 <em>个别</em> 对象以及对象 <em>组合</em> 。</p>
<p>组合模式让我们能用树形方式创建对象的结构，树里面包含了 <em>组合</em> 以及 <em>个别对象</em> 。使用组合结构，我们能把 <em>相同</em> 的操作应用在组合和个别对象上。换句话说，在大多数情况下，我们可以 <strong>忽略</strong> 对象组合和个别对象之间的差别。</p>
</blockquote>
<h3 id="组合模式-类图"><a href="#组合模式-——-类图" class="headerlink" title="组合模式 —— 类图"></a>组合模式 —— 类图</h3><p><img src="file:///mnt/D/%E7%AC%94%E8%AE%B0/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E7%BB%84%E5%90%88%E6%A8%A1%E5%BC%8F.png" alt=""></p>
<p>​    <strong>组合模式</strong> 以单一责任设计原则换取 <strong>透明性</strong>。透明性：通过让组件的接口同时包含一些管理子节点和页节点的操作，客户就可以将组合和叶节点一视同仁。</p>
<h3 id="组合迭代器"><a href="#组合迭代器" class="headerlink" title="组合迭代器"></a>组合迭代器</h3><p>​    这个 CompositeIterator 是一个不可小觑的迭代器。它的工作是遍历组件内的菜单项，而且确保所有的子菜单（以及子子菜单 …… ）都被包括进来。</p>
<p>​    <strong>空迭代器：</strong> 返回一个迭代器，而这个迭代器的 hasNext() 永远返回 false 。 </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//跟所有的迭代器一样，我们实现Iterator接口。 </span></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">CompositeIterator</span> <span class="keyword">implements</span> <span class="title">Iterator</span> </span>&#123; </div><div class="line">  	Stack stack = <span class="keyword">new</span> Stack(); </div><div class="line">  	<span class="comment">/* </span></div><div class="line">  	 *	将我们要遍历的顶层组合的迭代器传入，我们把它抛进一个堆栈数据结构中</div><div class="line">     */ </div><div class="line">  	<span class="function"><span class="keyword">public</span> <span class="title">CompositeIterator</span><span class="params">(Iterator iterator)</span> </span>&#123;</div><div class="line">      	stack.push(iterator); </div><div class="line">    &#125; </div><div class="line">  </div><div class="line">  	<span class="meta">@Override</span> <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">hasNext</span><span class="params">()</span> </span>&#123;</div><div class="line">      	<span class="comment">//想要知道是否还有下一个元素，我们检查堆栈是否被清空，如果已经空了，就表示没有下一个元素了 </span></div><div class="line">      	<span class="keyword">if</span> (stack.empty()) &#123; </div><div class="line">          	<span class="keyword">return</span> <span class="keyword">false</span>; </div><div class="line">        &#125; <span class="keyword">else</span> &#123; </div><div class="line">          	<span class="comment">/* </span></div><div class="line">          	 *	否则我们就从堆栈的顶层中取出迭代器，看看是否还有下一个元素，</div><div class="line">             *	如果它没有元素，我们将它弹出堆栈，然后递归调用hasNext()。 </div><div class="line">             */ </div><div class="line">          	Iterator iterator = (Iterator) stack.peek(); </div><div class="line">          	<span class="keyword">if</span> (!iterator.hasNext()) &#123;</div><div class="line">              	stack.pop(); </div><div class="line">              	<span class="keyword">return</span> hasNext(); </div><div class="line">            &#125; <span class="keyword">else</span> &#123; </div><div class="line">              	<span class="comment">//否则，便是还有下一个元素 </span></div><div class="line">              	<span class="keyword">return</span> <span class="keyword">true</span>; </div><div class="line">            &#125; </div><div class="line">        &#125; </div><div class="line">    &#125; </div><div class="line">  </div><div class="line">  	<span class="meta">@Override</span> <span class="function"><span class="keyword">public</span> Object <span class="title">next</span><span class="params">()</span> </span>&#123; </div><div class="line">      	<span class="comment">//好了，当客户想要取得下一个元素时候，我们先调用hasNext()来确定时候还有下一个。 </span></div><div class="line">      	<span class="keyword">if</span> (hasNext()) &#123; </div><div class="line">          	<span class="comment">//如果还有下一个元素，我们就从堆栈中取出目前的迭代器，然后取得它的下一个元素 </span></div><div class="line">          	Iterator iterator = (Iterator) stack.peek(); </div><div class="line">          	MenuComponent component = (MenuComponent) iterator.next(); </div><div class="line">          	<span class="comment">/* </span></div><div class="line">          	 *	如果元素是一个菜单，我们有了另一个需要被包含进遍历中的组合， </div><div class="line">          	 *	所以我们将它丢进对战中，不管是不是菜单，我们都返回该组件。 </div><div class="line">          	 */ </div><div class="line">          	<span class="keyword">if</span> (component <span class="keyword">instanceof</span> Menu) &#123; </div><div class="line">              	stack.push(component.createIterator());</div><div class="line">            &#125; </div><div class="line">          	<span class="keyword">return</span> component; </div><div class="line">        &#125; <span class="keyword">else</span> &#123; </div><div class="line">          	<span class="keyword">return</span> <span class="keyword">null</span>; </div><div class="line">        &#125; </div><div class="line">    &#125; </div><div class="line">  </div><div class="line">  	<span class="meta">@Override</span> <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">remove</span><span class="params">()</span> </span>&#123; </div><div class="line">      	<span class="keyword">throw</span> <span class="keyword">new</span> UnsupportedOperationException(); </div><div class="line">    &#125; </div><div class="line">&#125;</div></pre></td></tr></table></figure>
</div></article></div></main><footer><div class="paginator"><a href="/2017/07/26/状态模式/" class="prev">PREV</a><a href="/2017/07/25/模板方法模式/" class="next">NEXT</a></div><div class="copyright"><p>© 2017 <a href="http://yoursite.com">John Doe</a>, powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/pinggod/hexo-theme-apollo" target="_blank">hexo-theme-apollo</a>.</p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" integrity="sha384-crwIf/BuaWM9rM65iM+dWFldgQ1Un8jWZMuh3puxb8TOY9+linwLoI7ZHZT+aekW" crossorigin="anonymous"></script><script>(function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;e=o.createElement(i);r=o.getElementsByTagName(i)[0];e.src='//www.google-analytics.com/analytics.js';r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));ga('create',"UA-65933410-1",'auto');ga('send','pageview');</script></body></html>